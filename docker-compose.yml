# SNP Printer Service - Docker Compose
# For Unraid deployment

version: '3.8'

services:
  snp-printer:
    build: .
    container_name: snp-printer-service
    restart: unless-stopped
    ports:
      - "5000:5000"
    volumes:
      # Persist configuration (printers, notifications, monitoring settings)
      - ./data:/app/data
    environment:
      # Server
      - HOST=0.0.0.0
      - PORT=5000
      - DEBUG=${DEBUG:-false}

      # Config persistence
      - CONFIG_FILE=/app/data/config.json

      # Notifications (optional - can also set via web UI)
      - DISCORD_WEBHOOK_URL=${DISCORD_WEBHOOK_URL:-}
      - PUSHOVER_USER_KEY=${PUSHOVER_USER_KEY:-}
      - PUSHOVER_APP_TOKEN=${PUSHOVER_APP_TOKEN:-}

      # Security
      - REQUIRE_AUTH=${REQUIRE_AUTH:-false}
      - API_KEY_SNP_SITE=${API_KEY_SNP_SITE:-dev-key-snp-site}
      - API_KEY_ADMIN=${API_KEY_ADMIN:-dev-key-admin}

    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:5000/health')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
